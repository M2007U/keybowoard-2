<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>keybOwOard</title>
    <style>
    
        .centerContainer
        {
            position: fixed;
            justify-content: center;
            align-items: center;
            top:50%;
            left: 50%;
            transform:translate(-50%,-50%);
            
        }

        .centerRow
        {
            display:flex;
            justify-content: center;
            align-items: center;
            
        }

        .rectangle
        {
            width: 60px;
            height: 60px;
            background-color: rgba(255,204,0,0.1);

            margin: 5px;
            border: 0px solid rgba(255,204,0,1);
            border-collapse: collapse;
            border-radius: 10px;
            
            justify-content: center;
            align-items: center;
            
            display: flex;

            color:white;
            font-size: 16px;
            font-family:'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
        }

        .button
        {
            width: 30px;
            height: 30px;
            background-color: #ffcc00;
            opacity: 0.5;

            text-align: center;

            margin: 5px;
            border: 5px solid transparent;
            border-collapse: collapse;
            border-radius: 10px;
            
            justify-content: center;
            align-items: center;
            
            display: flex;

            font-size: 16px;
            font-family:'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;

            z-index: 1024;
        }

        .bar
        {
            width : 40px;
            height : 200px;
            background-color: #ffcc00;

            margin: 5px;
            border: 0px solid transparent;
            border-collapse: collapse;
            border-radius: 10px;
        }

        .blank
        {
            width: 60px;
            height: 60px;

            margin: 10px;
        }

        input[type="number"] {
            padding: 4px;
            font-size: 16px;
            border: 1px solid #666;
            border-radius: 5px;
            width: 50px;
            background-color: rgba(96,96,96,0);
            color:#666;
        }

        select {
            padding: 4px;
            font-size: 16px;
            border: 1px solid #666;
            border-radius: 5px;
            background-color:rgba(96,96,96,0);
            width: 50px;
            color:#666
        }

    </style>
</head>
<body  style="background-color: black ;font-family:Calibri, Consolas, 'Gill Sans', 'Gill Sans MT', 'Trebuchet MS', sans-serif;">


    <div class="centerContainer">
        <div class="centerRow" style="display:flex;color:#666;font-size:16px;width:1920px;">
            <span style="text-align: center;">
                ver 2025.0406.0021 <br>
                OSC = &nbsp&nbsp
                [oct : <text id="field_osc_octave">5</text>]&nbsp&nbsp
                [edotone : <text id="field_osc_edotone">0</text>]&nbsp&nbsp
                [type : <text id="field_osc_type">square</text>]&nbsp&nbsp

                [layout : 
                <select id="field_osc_layout">
                    <option value="1D">1D</option>
                    <option value="2D">2D</option>
                    <option value="explicit">Explicit</option>
                </select>]&nbsp&nbsp
                [edo : <input type="number" id="field_osc_edo" min="1" step="1" placeholder="notes per octave" value="12">]&nbsp&nbsp
                [fund : <input type="number" id="field_osc_fund" min="0.00390625" step="0.00390625" placeholder="fundamental freq" value="523.2511">]&nbsp&nbsp
                [freqX : <input type="number" id="field_osc_freqX" min="0.00390625" step="0.00390625" placeholder="freq factor X" value="1.5">]&nbsp&nbsp
                [freqY : <input type="number" id="field_osc_freqY" min="0.00390625" step="0.00390625" placeholder="freq factor Y" value="1.25">]
                <br>

                ADSR = &nbsp&nbsp
                [atk : <text id="field_adsr_atk">1</text>]&nbsp&nbsp
                [sus : <text id="field_adsr_sus">1</text>]&nbsp&nbsp
                [rel : <text id="field_adsr_rel">1</text>]&nbsp&nbsp
                [vol : <text id="field_adsr_vol">0.125</text>]<br>
                
                FILTER = &nbsp&nbsp
                [lowpass > freq : <text id="field_filter_lowpass_freq">20000</text>]&nbsp&nbsp
                [lowpass > reso : <text id="field_filter_lowpass_reso">1</text>]&nbsp&nbsp
                [hghpass > freq : <text id="field_filter_hghpass_freq">0</text>]&nbsp&nbsp
                [hghpass > reso : <text id="field_filter_hghpass_reso">1</text>]&nbsp&nbsp
                [lowshlf > freq : <text id="field_filter_lowshlf_freq">0</text>]&nbsp&nbsp
                [lowshlf > gain : <text id="field_filter_lowshlf_gain">0</text>]&nbsp&nbsp
                [hghshlf > freq : <text id="field_filter_hghshlf_freq">20000</text>]&nbsp&nbsp
                [hghshlf > gain : <text id="field_filter_hghshlf_gain">0</text>]<br>
                <br>
                <text style="color:#403000;">[Currently Adjusting : <text  id="CONTROL_print">ASDR > overall</text>]</text>

                <br>
            </span>
        </div>
        <div style="height:160px"></div>


        <div class="centerRow" style="align-items: baseline;">
            <div id="rec_18" class="rectangle"><span>1</span></div>
            <div id="rec_19" class="rectangle"><span>2</span></div>
            <div id="rec_1A" class="rectangle"><span>3</span></div>
            <div id="rec_1B" class="rectangle"><span>4</span></div>
            <div id="rec_1C" class="rectangle"><span>5</span></div>
            <div id="rec_1D" class="rectangle"><span>6</span></div>
            <div id="rec_1E" class="rectangle"><span>7</span></div>
            <div id="rec_1F" class="rectangle"><span>8</span></div>
        </div>
        <div class="centerRow" style="align-items: baseline;">
            <div id="rec_10" class="rectangle"><span>q</span></div>
            <div id="rec_11" class="rectangle"><span>w</span></div>
            <div id="rec_12" class="rectangle"><span>e</span></div>
            <div id="rec_13" class="rectangle"><span>r</span></div>
            <div id="rec_14" class="rectangle"><span>t</span></div>
            <div id="rec_15" class="rectangle"><span>y</span></div>
            <div id="rec_16" class="rectangle"><span>u</span></div>
            <div id="rec_17" class="rectangle"><span>i</span></div>
        </div>
        <div class="centerRow" style="align-items: baseline;">
            <div id="rec_08" class="rectangle"><span>a</span></div>
            <div id="rec_09" class="rectangle"><span>s</span></div>
            <div id="rec_0A" class="rectangle"><span>d</span></div>
            <div id="rec_0B" class="rectangle"><span>f</span></div>
            <div id="rec_0C" class="rectangle"><span>g</span></div>
            <div id="rec_0D" class="rectangle"><span>h</span></div>
            <div id="rec_0E" class="rectangle"><span>j</span></div>
            <div id="rec_0F" class="rectangle"><span>k</span></div>
        </div>
        <div class="centerRow" style="align-items: baseline;">
            <div id="rec_00" class="rectangle"><span>z</span></div>
            <div id="rec_01" class="rectangle"><span>x</span></div>
            <div id="rec_02" class="rectangle"><span>c</span></div>
            <div id="rec_03" class="rectangle"><span>v</span></div>
            <div id="rec_04" class="rectangle"><span>b</span></div>
            <div id="rec_05" class="rectangle"><span>n</span></div>
            <div id="rec_06" class="rectangle"><span>m</span></div>
            <div id="rec_07" class="rectangle"><span>,</span></div>
        </div>
        <div style="height:160px"></div>
        <div class="centerRow" style="display:flex;color:#606060;font-size:16px;width:1920px;">
            <span style="text-align: center;">
                <br>
                [! : ◯]&nbsp&nbsp&nbsp[@ : △]&nbsp&nbsp&nbsp[# : ◺]&nbsp&nbsp&nbsp[$ : ▢]&nbsp&nbsp&nbsp[0 : Toggle KeyText]&nbsp&nbsp&nbsp<text id="field_adktSetup" style="color:#600000;">[= : start / power / setup (MANDATORY)]</text><br>
                [z : oct ↓] &nbsp&nbsp&nbsp [x : oct ↑] &nbsp&nbsp&nbsp [c : trans ↓] &nbsp&nbsp&nbsp [v : trans ↑]  &nbsp&nbsp&nbsp 
                [b : module ←] &nbsp&nbsp&nbsp [n : param ←] &nbsp&nbsp&nbsp [m : param ↓] &nbsp&nbsp&nbsp [, : param ↑] &nbsp&nbsp&nbsp [. : param →] &nbsp&nbsp&nbsp [/ : module →] &nbsp&nbsp&nbsp [- : configure layout]<br>
                
            </span>
        </div>
        
    </div>










    <script>

        //---- ---- ---- ---- function declare

        function POwO_docgetel(InString)
        {
            return document.getElementById(InString);
        }

        function POwO_Math_Clamp(InMin, InVal, InMax)
        {
            
            //return Math.max(InMin, Math.min(InVal, InMax) );
            if (InVal > InMax)
            {
                return InMax;
            }
            else if (InVal < InMin)
            {
                return InMin;
            }
            else
            {
                return InVal;
            }

        }

        function POwO_Math_LERP(A, B, t)
        {
            return (B-A) * t + A
        }

        function POwO_setOscFreq(InExplicitList)
        {
            GLOBAL_freq = [];
            GLOBAL_freqFund = field_osc_fund.value;
            GLOBAL_layout = field_osc_layout.value;
            GLOBAL_edo = field_osc_edo.value;
            GLOBAL_freq_facX = field_osc_freqX.value;
            GLOBAL_freq_facY = field_osc_freqY.value;

            if (GLOBAL_layout === "1D")
            {
                for(let i = 0 ; i < Array_Rectangles.length ; i++)
                {
                    GLOBAL_freq.push(GLOBAL_freqFund * (2 ** (i/GLOBAL_edo)))
                }
            }
            else if (GLOBAL_layout === "2D")
            {
                for(let i = 0 ; i < 4 ; i++)
                {
                    for(let j = 0 ; j < 8 ; j++)
                    {
                        //i = 0 : box * (freqX ^ -1)
                        //j = 0 : box * (freY ^ -3)
                        GLOBAL_freq.push( GLOBAL_freqFund * ( GLOBAL_freq_facY ** (i-1) ) * ( GLOBAL_freq_facX ** (j-3)) )
                    }
                }
            }
            else if (GLOBAL_layout === "explicit")
            {
                if (InExplicitList.length === Array_AudioNodes_osc.length)
                {
                    GLOBAL_freq = InExplicitList
                }
            }

            for(let i = 0 ; i < Array_AudioNodes_osc.length ; i++)
            {
                Array_AudioNodes_osc[i].frequency.setValueAtTime(GLOBAL_freq[i],adkt.currentTime)
            }
        }

        function POwO_setOscType(Instring)
        {
            for(let i = 0 ; i < Array_AudioNodes_osc.length ; i++)
            {
                Array_AudioNodes_osc[i].type = Instring;
            }

            field_osc_type.textContent = Instring;
        }

        async function POwO_adktSetup()
        {
            //start the adkt
            await adkt.resume();

            //deal with oscilator
            POwO_setOscType("square")
            for(var i  = 0; i < Array_AudioNodes_adsr.length ; i++)
            {
                Array_AudioNodes_adsr[i].gain.setValueAtTime(0,adkt.currentTime);
            }
            POwO_setOscFreq(GLOBAL_freq, GLOBAL_layout,  GLOBAL_freqFund, GLOBAL_edo, GLOBAL_freq_facX , GLOBAL_freq_facY, [] , Array_AudioNodes_osc);
            

            //deal with filter
            AudioNodes_filter[0].gain.setValueAtTime(1,adkt.currentTime);
            AudioNodes_filter[1].type = 'lowpass';  AudioNodes_filter[1].frequency.setValueAtTime(20000   ,adkt.currentTime);    AudioNodes_filter[1].Q.setValueAtTime(1,adkt.currentTime);
            AudioNodes_filter[2].type = 'highpass'; AudioNodes_filter[2].frequency.setValueAtTime(0       ,adkt.currentTime);    AudioNodes_filter[2].Q.setValueAtTime(1,adkt.currentTime);
            AudioNodes_filter[3].type = 'lowshelf'; AudioNodes_filter[3].frequency.setValueAtTime(20000   ,adkt.currentTime);    AudioNodes_filter[3].gain.setValueAtTime(0,adkt.currentTime);
            AudioNodes_filter[4].type = 'highshelf';AudioNodes_filter[4].frequency.setValueAtTime(0       ,adkt.currentTime);    AudioNodes_filter[4].gain.setValueAtTime(0,adkt.currentTime);

            AudioNodes_gain.gain.setValueAtTime(0.1,adkt.currentTime);

            

            //connect everything
            for(let i = 0 ; i < Array_AudioNodes_osc.length ; i++)
            {
                Array_AudioNodes_osc[i].connect( Array_AudioNodes_adsr[i] );
                Array_AudioNodes_adsr[i].connect( AudioNodes_filter[0] );
            }
            for(let i = 0 ; i < AudioNodes_filter.length - 1 ; i++)
            {
                AudioNodes_filter[i].connect(AudioNodes_filter[i+1]);
            }
            AudioNodes_filter[5].connect(AudioNodes_gain)
            AudioNodes_gain.connect(adkt.destination);

            //start all the oscillators
            for(let i = 0 ; i < Array_AudioNodes_osc.length ; i++)
            {
                Array_AudioNodes_osc[i].start();
            }

            // connect successfuly, ready
            console.log("READY")
            field_adktSetup.style.color = "#006000"
            isREADY = true;

        }

        function POwO_musicButtonDown(event)
        {
            for(let i = 0 ; i < Array_KeyPressString.length ; i++)
            {
                if (event.key === Array_KeyPressString[i])
                {
                    Array_KeyPressDetect[i] = 1;
                }
            }
        }

        function POwO_musicButtonUp(event)
        {
            for(let i = 0 ; i < Array_KeyPressString.length ; i++)
            {
                if (event.key === Array_KeyPressString[i])
                {
                    Array_KeyPressDetect[i] = 0;
                }
            }
        }

        function POwO_musicAllNotesMigrate( InFactor )
        {
            console.log("Migrate : " + InFactor.toString())
            console.log(GLOBAL_freq)
            for(let i = 0 ; i < GLOBAL_freq.length ; i++)
            {
                GLOBAL_freq[i] = GLOBAL_freq[i] * InFactor;
                Array_AudioNodes_osc[i].frequency.setValueAtTime(GLOBAL_freq[i],adkt.currentTime);
                console.log("New Freq : " + Array_AudioNodes_osc[i].frequency)
            }

            
        }

        function POwO_control_ModL()
        {
            CONTROL_index_0 = (CONTROL_index_0 + (CONTROL_param.length - 1) ) % CONTROL_param.length;
            CONTROL_index_1 = 0;
            POwO_control_CurrentChoicePrint();
        }

        function POwO_control_ModR()
        {
            CONTROL_index_0 = (CONTROL_index_0 + 1) % CONTROL_param.length;
            CONTROL_index_1 = 0;
            POwO_control_CurrentChoicePrint();
        }

        function POwO_control_PrmL()
        {
            CONTROL_index_1 = (CONTROL_index_1 + (CONTROL_param[CONTROL_index_0].length - 1)) % CONTROL_param[CONTROL_index_0].length;
            POwO_control_CurrentChoicePrint();
        }

        function POwO_control_PrmR()
        {
            CONTROL_index_1 = (CONTROL_index_1 + 1) % CONTROL_param[CONTROL_index_0].length;
            POwO_control_CurrentChoicePrint();
        }

        function POwO_control_Change(InDirection)
        {
            let Direction = 1;
            if (InDirection === "+")
            {
                Direction = 1;
            }
            else if (InDirection === "-")
            {
                Direction = -1;
            }

            switch (CONTROL_index_0)
            {
                case 0: //ADSR
                    switch (CONTROL_index_1)
                    {
                        case 0 : GLOBAL_adsr_atk = POwO_Math_Clamp(1/256 , GLOBAL_adsr_atk + GLOBAL_adsr_dlt * Direction , 1);                                              field_adsr_atk.textContent = GLOBAL_adsr_atk.toString();         break;
                        case 1 : GLOBAL_adsr_sus = POwO_Math_Clamp(0, GLOBAL_adsr_sus + GLOBAL_adsr_dlt * Direction , 1);                                                   field_adsr_sus.textContent = GLOBAL_adsr_sus.toString();        break;
                        case 2 : GLOBAL_adsr_rel = POwO_Math_Clamp(1/256 , GLOBAL_adsr_rel + GLOBAL_adsr_dlt * Direction , 1);                                              field_adsr_rel.textContent = GLOBAL_adsr_rel.toString();        break;
                        case 3 : AudioNodes_gain.gain.setValueAtTime(POwO_Math_Clamp(0, AudioNodes_gain.gain.value + GLOBAL_vol_dlt * Direction,1), adkt.currentTime);      field_adsr_vol.textContent = AudioNodes_gain.gain.value.toString();  break;
                        default:break;
                    }
                break;
                case 1: //FILTER
                    switch (CONTROL_index_1)
                    {
                        case 0 : AudioNodes_filter[1].frequency.setValueAtTime( POwO_Math_Clamp(0,AudioNodes_filter[1].frequency.value + GLOBAL_filter_delta_freq * Direction,20000), adkt.currentTime); field_filter_lowpass_freq.textContent = AudioNodes_filter[1].frequency.value.toString(); break;
                        case 2 : AudioNodes_filter[2].frequency.setValueAtTime( POwO_Math_Clamp(0,AudioNodes_filter[2].frequency.value + GLOBAL_filter_delta_freq * Direction,20000), adkt.currentTime); field_filter_hghpass_freq.textContent = AudioNodes_filter[2].frequency.value.toString(); break;
                        case 4 : AudioNodes_filter[3].frequency.setValueAtTime( POwO_Math_Clamp(0,AudioNodes_filter[3].frequency.value + GLOBAL_filter_delta_freq * Direction,20000), adkt.currentTime); field_filter_lowshlf_freq.textContent = AudioNodes_filter[3].frequency.value.toString(); break;
                        case 6 : AudioNodes_filter[4].frequency.setValueAtTime( POwO_Math_Clamp(0,AudioNodes_filter[4].frequency.value + GLOBAL_filter_delta_freq * Direction,20000), adkt.currentTime); field_filter_hghshlf_freq.textContent = AudioNodes_filter[4].frequency.value.toString(); break;

                        case 1 : AudioNodes_filter[1].Q     .setValueAtTime( POwO_Math_Clamp(1,AudioNodes_filter[1].Q.value + GLOBAL_filter_delta_qval * Direction,1000), adkt.currentTime); field_filter_lowpass_reso.textContent = AudioNodes_filter[1].Q.value.toString(); break;
                        case 3 : AudioNodes_filter[2].Q     .setValueAtTime( POwO_Math_Clamp(1,AudioNodes_filter[2].Q.value + GLOBAL_filter_delta_qval * Direction,1000), adkt.currentTime); field_filter_hghpass_reso.textContent = AudioNodes_filter[2].Q.value.toString(); break;
                        case 5 : AudioNodes_filter[3].gain  .setValueAtTime( POwO_Math_Clamp(-8,AudioNodes_filter[3].gain.value + GLOBAL_filter_delta_decb * Direction,8), adkt.currentTime); field_filter_lowshlf_gain.textContent = AudioNodes_filter[3].gain.value.toString(); break;
                        case 7 : AudioNodes_filter[4].gain  .setValueAtTime( POwO_Math_Clamp(-8,AudioNodes_filter[4].gain.value + GLOBAL_filter_delta_decb * Direction,8), adkt.currentTime); field_filter_hghshlf_gain.textContent = AudioNodes_filter[4].gain.value.toString(); break;
                    
                        default:
                            break;
                    }
                break;
                default:
                break;
            }
        }

        function POwO_control_CurrentChoicePrint()
        {
            console.log(CONTROL_index_0);
            console.log(CONTROL_index_1);
            field_control_currentChoice.textContent = CONTROL_param[CONTROL_index_0][CONTROL_index_1];
        }






        //---- ---- ---- ---- global vars

        //html css related stuff
        var COLOR_ON = "1"
        var COLOR_OFF = "0.1"
        var Array_KeyPressString = ["z","x","c","v","b","n","m",",","a","s","d","f","g","h","j","k","q","w","e","r","t","y","u","i","1","2","3","4","5","6","7","8"]
        var Array_Rectangles =
        [
            POwO_docgetel("rec_00") , POwO_docgetel("rec_01") , POwO_docgetel("rec_02") , POwO_docgetel("rec_03") ,
            POwO_docgetel("rec_04") , POwO_docgetel("rec_05") , POwO_docgetel("rec_06") , POwO_docgetel("rec_07") ,
            POwO_docgetel("rec_08") , POwO_docgetel("rec_09") , POwO_docgetel("rec_0A") , POwO_docgetel("rec_0B") ,
            POwO_docgetel("rec_0C") , POwO_docgetel("rec_0D") , POwO_docgetel("rec_0E") , POwO_docgetel("rec_0F") ,

            POwO_docgetel("rec_10") , POwO_docgetel("rec_11") , POwO_docgetel("rec_12") , POwO_docgetel("rec_13") ,
            POwO_docgetel("rec_14") , POwO_docgetel("rec_15") , POwO_docgetel("rec_16") , POwO_docgetel("rec_17") ,
            POwO_docgetel("rec_18") , POwO_docgetel("rec_19") , POwO_docgetel("rec_1A") , POwO_docgetel("rec_1B") ,
            POwO_docgetel("rec_1C") , POwO_docgetel("rec_1D") , POwO_docgetel("rec_1E") , POwO_docgetel("rec_1F")
        ]
        var Array_KeyPressDetect = [];
        for(let i = 0 ; i < Array_KeyPressString.length ; i ++)
        {
            Array+Array_KeyPressDetect.push(0);
        }

        const field_osc_octave  = POwO_docgetel("field_osc_octave")
        const field_osc_edotone = POwO_docgetel("field_osc_edotone")
        const field_osc_type    = POwO_docgetel("field_osc_type")
        const field_osc_edo     = POwO_docgetel("field_osc_edo")
        const field_osc_layout  = POwO_docgetel("field_osc_layout")
        const field_osc_fund    = POwO_docgetel("field_osc_fund")
        const field_osc_freqX   = POwO_docgetel("field_osc_freqX")
        const field_osc_freqY   = POwO_docgetel("field_osc_freqY")

        const field_adsr_atk = POwO_docgetel("field_adsr_atk");
        const field_adsr_sus = POwO_docgetel("field_adsr_sus");
        const field_adsr_rel = POwO_docgetel("field_adsr_rel");
        const field_adsr_vol = POwO_docgetel("field_adsr_vol");

        const field_filter_lowpass_freq = POwO_docgetel("field_filter_lowpass_freq");
        const field_filter_lowpass_reso = POwO_docgetel("field_filter_lowpass_reso");
        const field_filter_hghpass_freq = POwO_docgetel("field_filter_hghpass_freq");
        const field_filter_hghpass_reso = POwO_docgetel("field_filter_hghpass_reso");
        const field_filter_lowshlf_freq = POwO_docgetel("field_filter_lowshlf_freq");
        const field_filter_lowshlf_gain = POwO_docgetel("field_filter_lowshlf_gain");
        const field_filter_hghshlf_freq = POwO_docgetel("field_filter_hghshlf_freq");
        const field_filter_hghshlf_gain = POwO_docgetel("field_filter_hghshlf_gain");

        const field_control_currentChoice = POwO_docgetel("CONTROL_print")
        const field_adktSetup = POwO_docgetel("field_adktSetup")


        //frequency related stuffs
        var GLOBAL_edo = 12;
        var GLOBAL_freqFund = 523.2511; //C5
        var GLOBAL_freq_facX = 3;
        var GLOBAL_freq_facY = 5; 
        var GLOBAL_freq = [];
        var GLOBAL_layout = "1D" //can be 1D or 2D

        //adsr related stuffs
        var GLOBAL_adsr_atk = 1;
        var GLOBAL_adsr_sus = 1;
        var GLOBAL_adsr_rel = 1;
        var GLOBAL_adsr_dlt = 1/256;

        //main volume
        var GLOBAL_vol_dlt = 1/256;

        //filter
        var GLOBAL_filter_delta_freq = 10;
        var GLOBAL_filter_delta_qval = 1;
        var GLOBAL_filter_delta_decb = 1/16;
        



        //---- ---- ---- ---- construct audio context

        //audio context
        var isREADY = false;
        const adkt = new (window.AudioContext || window.webkitAudioContext)();
        console.log("new audioKontext");



        const adkt_dummy_osc  = adkt.createOscillator();
        const adkt_dummy_adsr = adkt.createGain();



        //oscilators
        var Array_AudioNodes_osc = []
        for(let i = 0 ; i < Array_Rectangles.length ; i++){
            Array_AudioNodes_osc.push(adkt.createOscillator());
        }

        //adsr
        var Array_AudioNodes_adsr = []
        for(let i = 0 ; i < Array_Rectangles.length ; i++){
            Array_AudioNodes_adsr.push(adkt.createGain());
        }
        
        //filter node
        var AudioNodes_filter =[
            adkt.createGain(), //in
            adkt.createBiquadFilter(), //pass low
            adkt.createBiquadFilter(), //pass high
            adkt.createBiquadFilter(), //shlf low
            adkt.createBiquadFilter(), //shlf high
            adkt.createGain() //out
        ]
        

        //main volume
        var AudioNodes_gain = adkt.createGain()


        //Settings Array
        var CONTROL_param =
        [
            [
                "ADSR > attack",
                "ADSR > sustain",
                "ADSR > release",
                "ADSR > overall"
            ],
            [
                "FILTER > lowpass > frequency",
                "FILTER > lowpass > resonance",
                "FILTER > highpass > frequency",
                "FILTER > highpass > resonance",
                "FILTER > lowshelf > frequency",
                "FILTER > lowshelf > gain",
                "FILTER > highshelf > frequency",
                "FILTER > highshelf > gain"
            ]
        ]
        let CONTROL_index_0 = 0;
        let CONTROL_index_1 = 3;

        //---- ---- ---- ---- runtime flow

        
        

        document.addEventListener("keydown", (event) =>
        {
            console.log("got Keypress : " + event.key)

            POwO_musicButtonDown(event);

            if (event.key === "="){POwO_adktSetup()}
            else if (event.key === "Z"){POwO_musicAllNotesMigrate(0.5); field_osc_octave.textContent = Number(field_osc_octave.textContent)-1 }
            else if (event.key === "X"){POwO_musicAllNotesMigrate(2); field_osc_octave.textContent = Number(field_osc_octave.textContent)+1 }
            else if (event.key === "C"){POwO_musicAllNotesMigrate(1/(2**(1/GLOBAL_edo))) ; field_osc_edotone.textContent = Number(field_osc_edotone.textContent)-1}
            else if (event.key === "V"){POwO_musicAllNotesMigrate((2**(1/GLOBAL_edo))) ; field_osc_edotone.textContent = Number(field_osc_edotone.textContent)+1}
            else if (event.key === "B"){POwO_control_ModL()}
            else if (event.key === "N"){POwO_control_PrmL()}
            else if (event.key === "M"){POwO_control_Change("-")}
            else if (event.key === "<"){POwO_control_Change("+")}
            else if (event.key === ">"){POwO_control_PrmR()}
            else if (event.key === "?"){POwO_control_ModR()}
            //else if (event.key === "9"){}
            //else if (event.key === "0"){POwO_Action_KeyTextToggle()}
            else if (event.key === "-"){POwO_setOscFreq([]);}
            else if (event.key === "!"){POwO_setOscType("sine")}
            else if (event.key === "@"){POwO_setOscType("triangle")}
            else if (event.key === "#"){POwO_setOscType("sawtooth")}
            else if (event.key === "$"){POwO_setOscType("square")}
        });

        document.addEventListener("keyup", (event) =>
        {
            POwO_musicButtonUp(event);
        });

        setInterval(function(){
            if (isREADY)
            {
                for(var i = 0 ; i < Array_Rectangles.length ; i++)
                {
                    var TargetGain = Array_AudioNodes_adsr[i].gain.value;
                    if (Array_KeyPressDetect[i] === 1)
                    {
                        TargetGain = POwO_Math_Clamp(0,TargetGain + GLOBAL_adsr_atk, GLOBAL_adsr_sus);
                    }
                    else
                    {
                        TargetGain = POwO_Math_Clamp(0,TargetGain - GLOBAL_adsr_rel,1);
                    }

                    Array_AudioNodes_adsr[i].gain.setValueAtTime(  TargetGain, adkt.currentTime );

                    Array_Rectangles[i].style.backgroundColor = "rgba(255,204,0," + (POwO_Math_LERP(0.1,1,TargetGain)).toString() + ")" 
                }
                
            }
        },10)

        
        
        


    </script>
</body>